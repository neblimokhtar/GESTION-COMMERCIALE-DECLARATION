<link href="~/css/bootstrap-datepicker3.min.css" rel="stylesheet" type="text/css" />
<link href="~/css/select2.min.css" rel="stylesheet" type="text/css" />
<style type="text/css">
    #Tableau tbody tr {
        cursor: pointer;
    }

        #Tableau tbody tr:hover {
            background-color: #23c6c8;
        }
</style>
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Nouvelle Déclaration</h2>
        <ol class="breadcrumb">
            <li><a>BCD</a> </li>
            <li class="active"><strong>@ViewBag.TRIMESTRE</strong></li>
            <li class="active"><strong>@ViewBag.ANNEE</strong></li>
            <li class="active"><strong>@ViewBag.SOCIETE</strong></li>
        </ol>
    </div>
    <div class="col-lg-2">
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    @using (Html.BeginForm("SendSecondEditForm", "DeclarationBCD", new { ParamPassed = ViewBag.ParamPassed, Code = ViewBag.Code }, FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
    {
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="padding-left: 0px; text-align: initial;">
                        NUMERO BC</label>
                    <div class="col-lg-8">
                        <input type="text" class="form-control" name="NUMERO_BC" id="NUMERO_BC" required value="@Model.NUMERO_BC">
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="text-align: initial;">
                        DATE BC</label>
                    <div class="col-lg-8">
                        <div class="input-group date">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            <input type="text" class="form-control" name="DATE_BC" id="DATE_BC" required value="@Model.DATE_BC.ToShortDateString()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="padding-left: 0px; text-align: initial;">
                        MATRICULE FISCAL</label>
                    <div class="col-lg-8">
                        <input type="text" class="form-control" name="MATRICULE" id="MATRICULE" readonly required>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="text-align: initial;">
                        FOURNISSEUR</label>
                    <div class="col-lg-8">
                        <select class="form-control" name="fournisseur" id="fournisseur">
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="padding-left: 0px; text-align: initial;">
                        NUMERO FACTURE</label>
                    <div class="col-lg-8">
                        <input type="text" class="form-control" name="NUMERO_FACTURE" id="NUMERO_FACTURE" required value="@Model.NUMERO_FACTURE">
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="text-align: initial;">
                        DATE FACTURE</label>
                    <div class="col-lg-8">
                        <div class="input-group date">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            <input type="text" class="form-control" name="DATE_FACTURE" id="DATE_FACTURE" required value="@Model.DATE_FACTURE.ToShortDateString()">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="padding-left: 0px; text-align: initial;">
                        PRIX H.T</label>
                    <div class="col-lg-8">
                        <input type="text" class="form-control" name="PRIX_HT" id="PRIX_HT" required value="@Model.PRIX_HT">
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="text-align: initial;">
                        TVA</label>
                    <div class="col-lg-8">
                        <select name="TVA" class="form-control" id="TVA">
                            <option value="0">0</option>
                            <option value="6">6</option>
                            <option value="12">12</option>
                            <option value="18">18</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="padding-left: 0px; text-align: initial;">
                        OBJET</label>
                    <div class="col-lg-8">
                        <input type="text" class="form-control" name="OBJET" id="OBJET" required value="@Model.OBJET">
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label class="col-lg-4 control-label" style="padding-left: 0px; text-align: initial;">
                        NUMERO AUTORISATION</label>
                    <div class="col-lg-8">
                        <input type="text" class="form-control" name="NUMERO_AUTORISATION" id="NUMERO_AUTORISATION" required value="@Model.NUMERO_AUTORISATION">
                    </div>
                </div>
            </div>
        </div>
        <input type="hidden" name="ACTION" id="ACTION" />
        <div class="row pull-right" style="margin-right: 15px; margin-top: 15px;">
            <button type="button" class="btn btn-w-m btn-success" id="Valider"><i class="fa fa-check-square-o" aria-hidden="true"></i>Valider</button>
            <button class="btn btn-info btn-circle " type="button" id="AddRow">
                <i class="fa fa-check"></i>
            </button>
            <button class="btn btn-warning btn-circle" type="button" id="DeleteRow">
                <i class="fa fa-times"></i>
            </button>
        </div>
    }
    <hr />
    <hr />
    <div id="Content"></div>
</div>
<script src="~/js/bootstrap-datepicker.min.js" type="text/javascript"></script>
<script src="~/js/select2.min.js" type="text/javascript"></script>
<script type="text/javascript" src="~/js/plugins/dataTables/jquery.dataTables.js"></script>
<script type="text/javascript" src="~/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script type="text/javascript" src="~/js/plugins/dataTables/dataTables.responsive.js"></script>
<script type="text/javascript" src="~/js/plugins/dataTables/dataTables.tableTools.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var Code = "@ViewBag.Code";
        $.get('@Url.Action("MyPartialViewEdit", "DeclarationBCD")?Code=' + Code, function (data) {
            $('#Content').html(data);
        });
        var table = $('#Tableau').DataTable();
        $("#DATE_BC").datepicker({
            format: 'dd/mm/yyyy'
        });
        $("#DATE_FACTURE").datepicker({
            format: 'dd/mm/yyyy'
        });
        $("#fournisseur").select2();
        var table = $('#Tableau').DataTable();

        var fournisseur = "@Model.FOURNISSEUR";
        $('#fournisseur').append($('<option>', {
            value: "",
            text: ""
        }));
        $.ajax({
            type: 'POST',
            url: "/Achat/GetAllFournisseur",
            success: function (response) {
                $.each(response, function (i, item) {
                    $('#fournisseur').append($('<option>', {
                        value: item.ID,
                        text: item.NOM
                    }));
                    $("#fournisseur").val(fournisseur).trigger("change");
                });
            }
        });
        var TVA = "@Model.TVA";
        var ParamPassed = "@ViewBag.ParamPassed";
        if (ParamPassed > 0) {
            $("#DeleteRow").attr("disabled", false);
        }
        $("#TVA option").filter(function () {
            return $(this).text() == TVA;
        }).prop('selected', true);

    });
    $('#fournisseur').on('change', function () {
        $("#codeFournisseur").val("");
        if (this.value != "") {
            $.ajax({
                type: 'POST',
                url: "/Achat/GetFournisseuryID?ID=" + this.value,
                success: function (response) {
                    $("#MATRICULE").val(response.ID_FISCAL);
                }
            });
        }
    });
    $("#Previous").click(function () {
        $("#ACTION").val("BACK");
        $("form").submit();
        $("#WithPrint").val("");
    });
    $("#Print").click(function () {
        var Code = "@ViewBag.Code";
        window.open("/DeclarationBCD/PrintDeclaration?Code=" + Code, '_blank');
    });
    $("#Valider").click(function () {
        var r = confirm("Voulez vous vraiment valider cette déclaration ?");
        if (r == true) {
            $("#ACTION").val("VALIDATE");
            $("form").submit();
            $("#WithPrint").val("");
        }
    });
    $("#AddRow").click(function () {
        //var isValid = $("form").isValid();
        //if (isValid) {
        $('form').validate();
        $("#ACTION").val("ADD");
        $("form").submit();
        $("#WithPrint").val("");
        //}
    });
    $("#DeleteRow").click(function () {
        var r = confirm("Voulez vous vraiment supprimer cette ligne ?");
        if (r == true) {
            $("#ACTION").val("DELETE");
            $("form").submit();
            $("#WithPrint").val("");
        }

    });
</script>
